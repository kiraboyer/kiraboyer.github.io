 
<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Arrange the scene for showtime!</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
		<link type="text/css" rel="stylesheet" href="main.css">
	 <!-- attributes: fbx code= https://codesandbox.io/s/y2kv8yyw5j
					  DragControls.js reference = https://threejs.org/docs/#examples/zh/controls/DragControls
					  DragControls.js reference = https://github.com/mrdoob/three.js/blob/master/examples/misc_controls_drag.html -->
		<style>
			.divy{
		 width:90%;
		/* height:5%;*/
		 text-align:center;


		}

	p{
	font-family: 'Roboto', sans-serif;
	text-align:center;
}
</style>
	</head>
<script src="../build/three.js"></script>
<!-- for FBX lib reference -->
<!-- <script src="./js/libs/stats.min.js"></script>  -->
	<body >
<!-- for phone compatibility  -->
<script src="./js/Detector.js"></script>
		<script type="module">

			import * as THREE from '../build/three.module.js';

			import { DDSLoader } from './jsm/loaders/DDSLoader.js';
			import { MTLLoader } from './jsm/loaders/MTLLoader.js';
			import { OBJLoader } from './jsm/loaders/OBJLoader.js';
			import { DragControls } from './jsm/controls/DragControls4.js';
			 

 
//defining variables used in code, called again later.
			var container, controls;

			var camera, scene, renderer;
			var video, texture, material,mesh, geometry;

			var mouseX = 0, mouseY = 0;

			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;

//for mobile detection
  if ( ! Detector.webgl ) Detector.addGetWebGLMessage();
  //init and animation functions being called
			init();
			animate();


			function init() {
//scene in div container
				container = document.createElement( 'div' );
				document.body.appendChild( container );
//camera viewpoint
				camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 2000 );
				camera.position.z = 250;

//scene

				scene = new THREE.Scene();

//lighting
//ambient lighting everywhere
				var ambientLight = new THREE.AmbientLight( 0xcccccc, 0.4 );
				scene.add( ambientLight );
//spotlight
				var pointLight = new THREE.PointLight( 0xffffff, 0.4 );
				camera.add( pointLight );
				scene.add( camera );

//get video from body
				video = document.getElementById('video');
//play video
				video.play();
//use VideoTexture from three.js with video 
				texture = new THREE.VideoTexture(video);

// model download percentage console log tracking

				var onProgress = function ( xhr ) {

					if ( xhr.lengthComputable ) {

						var percentComplete = xhr.loaded / xhr.total * 100;
						console.log( Math.round( percentComplete, 2 ) + '% downloaded' );

					}

				};

				 var onError = function () { };

				 var manager = new THREE.LoadingManager();
				 manager.addHandler( /\.dds$/i, new DDSLoader() );


//calling out some variables for a video.
var xsize, ysize, materials;
 
xsize = 480;
ysize = 240;

 
var parameters = {color:0xffffff, map: texture};

geometry = new THREE.BoxBufferGeometry (xsize, ysize, xsize);
 
materials = new THREE.MeshLambertMaterial (parameters);
material = materials;
mesh = new THREE.Mesh (geometry, material);

mesh.scale.x=mesh.scale.y=mesh.scale.z=.3;
mesh.position.x= -20; //-20
mesh.position.y=22; //20
mesh.position.z=-15;
mesh.rotation.x = .2;
scene.add(mesh);



 




 
 //constant reference to objects array of the draggable backdrop			//wrap around all objs	
const objects = [];

//variable j is the MTLLoader.js
				 var j = new MTLLoader( manager )
//MTLLoader path to load mtl file
					 .setPath( 'models/obj/male02/' )
					 .load( 'moon.mtl', function ( materials ) {
//preload mtl file
						 materials.preload();

//variable l -s the OBJLoader.js
				var l= new OBJLoader( manager )
//give the obj it's mtl
							 .setMaterials( materials )
//path to obj
							.setPath( 'models/obj/male02/' )
							.load( 'moon.obj', function ( object ) {
//obj position in scene
								object.position.x = 104; //113
					  			object.position.y = -20;			
  								object.position.z = 80;
								object.rotation.x = .2;
								object.scale.x = 1.3;
								object.scale.y = 1.3;
								object.scale.z = 1.3;
//add obj to the Scene
								scene.add( object );

//push the array "objects", adding "object" to the array
								objects.push( object );
//console log information

							 }, onProgress, onError );

//using MTLLoader and manager
				 var j = new MTLLoader( manager )

//file path to star model
					 .setPath( 'models/obj/male02/' )
//load star material
					 .load( 'star5.mtl', function ( materials ) {
//preload materials
 
					  	materials.preload();

 
				var l= new OBJLoader( manager )
 
							 .setMaterials( materials )
 
							.setPath( 'models/obj/male02/' )
							.load( 'star5.obj', function ( object ) {
  	object.position.x = 78;
								object.position.y = -20;
								object.position.z = 90;
								object.rotation.x = .2;
								object.scale.x = .6;
								object.scale.y = .6;
 
								scene.add( object );

 
								objects.push( object );
 

							 }
							 , onProgress, onError 
							 );


							//using MTLLoader and manager
				 var j = new MTLLoader( manager )

//file path to star model
					 .setPath( 'models/obj/male02/' )
//load star material
					 .load( 'boatp.mtl', function ( materials ) {
//preload materials
 
					  	materials.preload();

 
				var l= new OBJLoader( manager )
 
							 .setMaterials( materials )
 
							.setPath( 'models/obj/male02/' )
							.load( 'boatp.obj', function ( object ) {
  	
								// object.position.y =  0
								 object.position.x =  -20
								  object.position.z = -23;
								// object.rotation.x = .2;
								object.scale.x = .3;
								object.scale.y = .3;
 
								scene.add( object );

 
								objects.push( object );
 

							 }
							 , onProgress, onError 
							 );



							 var j = new MTLLoader( manager )
 
					 .setPath( 'models/obj/male02/' )
					 .load( 'cloud3.mtl', function ( materials ) {
 
					  	materials.preload();

 
				var l= new OBJLoader( manager )
 
							 .setMaterials( materials )
 
							.setPath( 'models/obj/male02/' )
							.load( 'cloud3.obj', function ( object ) {
  								object.position.x= 87;
								object.position.y = -15;
								object.position.z = 96;
								object.rotation.x = .2;
								object.rotation.y = 3;
					 
								object.scale.x = 3;
								object.scale.y = 3;
 
								scene.add( object );

 
								objects.push( object );
 

							 }
							 , onProgress, onError 
							 );


							 var j = new MTLLoader( manager )
 
					 .setPath( 'models/obj/male02/' )
					 .load( 'water2.mtl', function ( materials ) {
 
					  	materials.preload();

 
				var l= new OBJLoader( manager )
 
							 .setMaterials( materials )
 
							.setPath( 'models/obj/male02/' )
							.load( 'water2.obj', function ( object ) {
  	
								object.position.y = -9;
								object.position.x = 91;//88
								object.position.z = 90;
								object.rotation.x = .2;
								object.rotation.y = 0;
					 
								object.scale.x = 1;
								object.scale.y = 1;
 
								scene.add( object );

 
								objects.push( object );
 

							 }
							 , onProgress, onError 
							 );



 var j = new MTLLoader( manager )
 
					 .setPath( 'models/obj/male02/' )
					 .load( 'water2.mtl', function ( materials ) {
 
					  	materials.preload();

 
				var l= new OBJLoader( manager )
 
							 .setMaterials( materials )
 
							.setPath( 'models/obj/male02/' )
							.load( 'water2.obj', function ( object ) {
  	
								object.position.y = 8;
								object.position.z = 89;
								object.rotation.x = .3;
								object.rotation.y = 0;
					 
								object.scale.x = 1;
								object.scale.y = 1;
 
								scene.add( object );

 
								objects.push( object );
 

							 }
							 , onProgress, onError 
							 );

							 var j = new MTLLoader( manager )
 
					 .setPath( 'models/obj/male02/' )
					 .load( 'water2.mtl', function ( materials ) {
 
					  	materials.preload();

 
				var l= new OBJLoader( manager )
 
							 .setMaterials( materials )
 
							.setPath( 'models/obj/male02/' )
							.load( 'water2.obj', function ( object ) {
  	
								object.position.y = 8;
								object.position.z = 89;
								object.rotation.x = .4;
								object.rotation.y = 0;
					 
								object.scale.x = 1;
								object.scale.y = 1;
 
								scene.add( object );

 
								objects.push( object );
 

							 }
							 , onProgress, onError 
							 );
							 var j = new MTLLoader( manager )
 
					 .setPath( 'models/obj/male02/' )
					 .load( 'water2.mtl', function ( materials ) {
 
					  	materials.preload();

 
				var l= new OBJLoader( manager )
 
							 .setMaterials( materials )
 
							.setPath( 'models/obj/male02/' )
							.load( 'water2.obj', function ( object ) {
  	
								object.position.y = 8;
								object.position.z = 88;
								object.rotation.x = .5;
								object.rotation.y = 0;
					 
								object.scale.x = 1;
								object.scale.y = 1;
 
								scene.add( object );

 
								objects.push( object );
 

							 }
							 , onProgress, onError 
							 );

							 var j = new MTLLoader( manager )
 
					 .setPath( 'models/obj/male02/' )
					 .load( 'water2.mtl', function ( materials ) {
 
					  	materials.preload();

 
				var l= new OBJLoader( manager )
 
							 .setMaterials( materials )
 
							.setPath( 'models/obj/male02/' )
							.load( 'water2.obj', function ( object ) {
  	
								object.position.y = 8;
								object.position.z = 87;
								object.rotation.x = .6;
								object.rotation.y = 0;
					 
								object.scale.x = 1;
								object.scale.y = 1;
 
								scene.add( object );

 
								objects.push( object );
 

							 }
							 , onProgress, onError 
							 );




//controls variable is equal to DragControls.js, add objects array, camera, and the domElement
var controls = new DragControls( objects, camera, renderer.domElement );
//event listener for mouse clicking
				controls.addEventListener( 'dragstart', dragStartCallback );
//event listener for mouse release
   			    controls.addEventListener( 'dragend', dragendCallback );
				

				} );
//add 1 of these for each object added
				  } );
					 } );
					  } );
					 } );
					 } );
 } );
 					 } );
  } ); 
//when object is clicked and dragged it turns a lighter color
function dragStartCallback(event) {
   event.object.material.emissive.set( 0xaaaaaa );
}

//when object is released by releasing mouse click, color of obj returns to normal
function dragendCallback(event) {
    event.object.material.emissive.set( 0x000000 );
    //add to scale up objs
    event.object.scale.y = 2;
    event.object.scale.x = 2}





				 
//static objects//



//variable j is the MTLLoader.js

		var j = new MTLLoader( manager )
//MTLLoader path to load mtl file
				.setPath( 'models/obj/male02/' )
				.load( 'theaterCurtains.mtl', function ( materials ) {
//preload mtl file
					materials.preload();

//variable l -s the OBJLoader.js
						 var l= new OBJLoader( manager )
//give the obj it's mtl
							.setMaterials( materials )
//path to obj
							.setPath( 'models/obj/male02/' )
							.load( 'theaterCurtains.obj', function ( object ) {
//obj position/scale in scene

								object.position.y = 40;
								object.position.x = -26; //-22
								object.position.z = -105;
								object.scale.x = 1;
							    object.scale.y = 1;
								object.scale.z = 1;
								object.rotation.x = .2;
//add obj to the scene
								scene.add( object );
								
//console log information
							}, onProgress, onError );

		});



	 var j = new MTLLoader( manager )
 
					 .setPath( 'models/obj/male02/' )
					 .load( 'box.mtl', function ( materials ) {
 
					  	materials.preload();

 
				var l= new OBJLoader( manager )
 
							 .setMaterials( materials )
 
							.setPath( 'models/obj/male02/' )
							.load( 'box.obj', function ( object ) {
  	
								object.position.x =  33;//37
								object.position.y = -38;
								object.position.z = 72; //80
								// object.rotation.x = .2;
								object.rotation.y = 3;
					 
								object.scale.x = 4.5;
								object.scale.y = 4.5;
								object.scale.z = 3;
 
								scene.add( object );

 
								 
 

							 }
							 , onProgress, onError 
							 );

});

					  var j = new MTLLoader( manager )

//file path to star model
					 .setPath( 'models/obj/male02/' )
//load star material
					 .load( 'boatp.mtl', function ( materials ) {
//preload materials
 
					  	materials.preload();

 
				var l= new OBJLoader( manager )
 
							 .setMaterials( materials )
 
							.setPath( 'models/obj/male02/' )
							.load( 'boatp.obj', function ( object ) {
  	
								// object.position.y =  0
								 object.position.x =  -20
								  object.position.z = -23;
								// object.rotation.x = .2;
								object.scale.x = .3;
								object.scale.y = .3;
 
								scene.add( object );

 
								objects.push( object );
 

							 }
							 , onProgress, onError 
							 );

							});

//static objects end///							

				 

//rendering based on device's window size

				renderer = new THREE.WebGLRenderer();
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				container.appendChild( renderer.domElement );


				window.addEventListener( 'resize', onWindowResize, false );
//stats js code for FBX. monitors fps
				// stats = new Stats();
				// container.appendChild( stats.dom );
			}

//container size
			function onWindowResize() {

				windowHalfX = window.innerWidth - 2;
				windowHalfY = window.innerHeight - 2;

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			

			function animate() {
//callc render function		 
				render();


//for FBX animation and FPS clock
  				requestAnimationFrame( animate );
// //conditional statement. if mixers animation length is greater than 0
// 				if ( mixers.length > 0 ) {
// //for loop. variable i is equal to 0. i is less than length of mixers animation
// //i + 1
// 					for ( var i = 0; i < mixers.length; i ++ ) {
// //mixers with i variable updates clock tracking fps

// 						mixers[ i ].update( clock.getDelta() );

// 					}

// 				}
//render scene and camera
				renderer.render( scene, camera );
//update stats of fps for FBX
				// stats.update();

			}
//render function
			function render() {
//camera position in scene
				camera.position.x += ( mouseX - camera.position.x ) * .05;
				camera.position.y += ( - mouseY - camera.position.y ) * .05;

				camera.lookAt( scene.position );

				renderer.render( scene, camera );

			}

 








 

		</script>
		<!-- video background will autoplay if muted, will work on mobile of using playsinline, loop will make the video loop forever. -->
 <video id="video" loop crossOrigin="anonymous" muted playsinline style="display:none">
 	<source src="models/obj/male02/sky.mp4" type='video/mp4'></video>
 		<div class="divy"><p>Kira Boyer - <i>Theater</i> - <a href="https://kiraboyer.github.io/">Artist's Website</a></p>
 			<p>Click or press and drag objects from the prop box into the theater scene. For optimal viewing on a mobile phone device, hold device in landscape mode. </p>
 		</div>
	</body>
</html>
