<!DOCTYPE html>
<html lang="en">
    <head>
        <title>three.js webgl - drag controls</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link type="text/css" rel="stylesheet" href="main.css">
        <style>
            body {
                background-color: #f0f0f0;
                color: #444;
            }
            a {
                color: #08f;
            }
        </style>
    </head>
    <body>

        <div id="info">
            <a href="https://threejs.org" target="_blank" rel="noopener">three.js</a> webgl - drag controls
        </div>

        <script type="module">
            import * as THREE from '../build/three.module.js';
            import Stats from './js/stats.module.js';
            import { DragControls } from './js/controls/DragControls.js';
            import { DDSLoader } from './js/loaders/DDSLoader.js';
            import { MTLLoader } from './js/loaders/MTLLoader.js';
            import { OBJLoader } from './js/loaders/OBJLoader.js';
              import { STLLoader } from './js/loaders/STLLoader.js';




            var container, stats;
            var camera, scene, renderer;
            var objects = [];
            init();
            animate();
            function init() {
                container = document.createElement( 'div' );
                document.body.appendChild( container );
                camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 5000 );
                camera.position.z = 1000;
                scene = new THREE.Scene();
                scene.background = new THREE.Color( 0xf0f0f0 );
                scene.add( new THREE.AmbientLight( 0x505050 ) );
                var light = new THREE.SpotLight( 0xffffff, 1.5 );
                light.position.set( 0, 500, 2000 );
                light.angle = Math.PI / 9;
                light.castShadow = true;
                light.shadow.camera.near = 1000;
                light.shadow.camera.far = 4000;
                light.shadow.mapSize.width = 1024;
                light.shadow.mapSize.height = 1024;
                scene.add( light );
                
                var manager = new THREE.LoadingManager();
                manager.addHandler( /\.dds$/i, new DDSLoader() );
                 
                // new MTLLoader( manager )
                //     .setPath( 'models/obj/male02/' )
                //     .load( 'male02_dds.mtl', function ( materials ) {
                //         materials.preload();
                        new STLLoader( manager )
                            // .setMaterials( materials )
                            .setPath( 'models/' )
                            .load( 'fox.stl', function ( object ) {
                                object.position.y = - 95;
                                scene.add( object );
                            }, onProgress, onError );
                 
                //
                renderer = new THREE.WebGLRenderer();
                renderer.setPixelRatio( window.devicePixelRatio );
                renderer.setSize( window.innerWidth, window.innerHeight );
                container.appendChild( renderer.domElement );}
                renderer = new THREE.WebGLRenderer( { antialias: true } );
                renderer.setPixelRatio( window.devicePixelRatio );
                renderer.setSize( window.innerWidth, window.innerHeight );
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFShadowMap;
                container.appendChild( renderer.domElement );
                var controls = new DragControls( objects, camera, renderer.domElement );
                controls.addEventListener( 'dragstart', function ( event ) {
                    event.object.material.emissive.set( 0xaaaaaa );
                } );
                controls.addEventListener( 'dragend', function ( event ) {
                    event.object.material.emissive.set( 0x000000 );
                } );
                stats = new Stats();
                container.appendChild( stats.dom );
                //
                window.addEventListener( 'resize', onWindowResize, false );
         
            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize( window.innerWidth, window.innerHeight );
            }
            //
            function animate() {
                requestAnimationFrame( animate );
                render();
                stats.update();
            }
            function render() {
                renderer.render( scene, camera );
            }
        </script>

    </body>
</html>